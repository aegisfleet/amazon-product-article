{{ define "main" }}
<div class="container" style="padding-top: var(--spacing-xl);">
    {{ partial "breadcrumb.html" . }}

    <article class="article-content">
        <header class="article-header">
            {{ if .Params.categories }}
            <span class="card-tag">{{ index .Params.categories 0 }}</span>
            {{ else }}
            {{ with .Params.category }}<span class="card-tag">{{ . }}</span>{{ end }}
            {{ end }}
            <h1 class="hero-title" style="margin-top: var(--spacing-sm);">{{ .Title }}</h1>
            <div class="article-meta">
                <span>å…¬é–‹æ—¥: {{ .Date.Format "2006å¹´01æœˆ02æ—¥" }}</span>
                {{ with .Params.author }}<span> â€¢ è‘—è€…: {{ . }}</span>{{ end }}
            </div>
        </header>

        {{ if .TableOfContents }}
        <nav class="table-of-contents" id="toc" style="display: none;">
            <details open>
                <summary>ğŸ“‘ ç›®æ¬¡</summary>
                {{ .TableOfContents }}
            </details>
        </nav>
        {{ end }}

        <div class="content">
            {{ .Content }}
        </div>

        <script>
            (function () {
                var toc = document.getElementById('toc');
                if (toc) {
                    var firstH2 = document.querySelector('.content h2');
                    if (firstH2) {
                        firstH2.parentNode.insertBefore(toc, firstH2);
                    }
                    toc.style.display = 'block';
                }
            })();
        </script>

    </article>

    {{ $currentAsin := .Params.asin }}
    {{ $categories := .Params.categories }}
    {{ $related := where (where .Site.RegularPages "Section" "articles") "Params.asin" "!=" $currentAsin }}
    {{ if $categories }}
    {{ $firstCat := index $categories 0 }}
    {{ $related = where $related "Params.categories" "intersect" (slice $firstCat) }}
    {{ end }}

    {{ if gt (len $related) 0 }}
    <section class="related-articles"
        style="margin-top: var(--spacing-xl); border-top: 1px solid var(--color-border); padding-top: var(--spacing-lg);">
        <h2 style="margin-bottom: var(--spacing-md);">åŒã˜ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®æœ€æ–°è¨˜äº‹</h2>
        <div class="product-grid">
            {{ range first 3 $related }}
            {{ partial "product-card.html" . }}
            {{ end }}
        </div>
    </section>
    {{ end }}
</div>
{{ end }}