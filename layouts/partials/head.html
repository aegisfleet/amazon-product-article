<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5TLPZJ1M1D"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());

  gtag('config', 'G-5TLPZJ1M1D');
</script>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{ if .IsHome }}{{ .Site.Title }}{{ else if .Params.score }}{{ .Title }} レビュー【{{ .Params.score }}点】 | {{ .Site.Title }}{{ else }}{{ .Title }} レビュー | {{ .Site.Title }}{{ end }}</title>
<meta name="description"
  content="{{ if .Description }}{{ .Description }}{{ else if .IsPage }}{{ .Summary | truncate 160 }}{{ else }}{{ .Site.Params.description }}{{ end }}">
<link rel="canonical" href="{{ .Permalink }}">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="{{ if .IsHome }}website{{ else }}article{{ end }}">
<meta property="og:url" content="{{ .Permalink }}">
<meta property="og:title"
  content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}">
<meta property="og:description"
  content="{{ with .Description }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}">
<meta property="og:image"
  content="{{ with .Params.images }}{{ index . 0 }}{{ else }}{{ `images/default-ogp.png` | absURL }}{{ end }}">
<meta property="og:site_name" content="{{ .Site.Title }}">
<meta property="og:locale" content="ja_JP">

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="{{ .Permalink }}">
<meta name="twitter:title"
  content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}">
<meta name="twitter:description"
  content="{{ with .Description }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}">
<meta name="twitter:image"
  content="{{ with .Params.images }}{{ index . 0 }}{{ else }}{{ `images/default-ogp.png` | absURL }}{{ end }}">

<!-- Favicon -->
<link rel="icon" type="image/png" href="{{ `favicon.png` | relURL }}">
<link rel="apple-touch-icon" href="{{ `apple-touch-icon.png` | relURL }}">

<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link
  href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Noto+Sans+JP:wght@400;500;700&display=swap"
  rel="stylesheet">

<!-- CSS -->
<link rel="stylesheet" href="{{ `css/variables.css` | relURL }}">
<link rel="stylesheet" href="{{ `css/style.css` | relURL }}">
{{ if .IsHome }}
<link rel="stylesheet" href="{{ `css/search.css` | relURL }}">
{{ end }}

<script>
  (function () {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
      document.documentElement.setAttribute('data-theme', savedTheme);
    }
  })();
</script>
<script src="{{ `js/theme.js` | relURL }}" defer></script>
{{ if .Params.asin }}
<script src="{{ `js/carousel.js` | relURL }}" defer></script>
{{ end }}

<!-- Structured Data (JSON-LD) -->
<!-- WebSite Schema (Home) -->
{{ if .IsHome }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "{{ .Site.Title }}",
  "url": "{{ .Site.BaseURL }}",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "{{ .Site.BaseURL }}search/?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>
{{ end }}

<!-- Product Schema (Single Pages with ASIN) -->
{{ if and .IsPage .Params.asin }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Product",
  "name": "{{ .Title }}",
  "image": [
    {{ range $i, $e := .Params.images }}{{ if $i }},{{ end }}"{{ $e | absURL }}"{{ end }}
   ],
  "description": "{{ .Description }}",
  "brand": {
    "@type": "Brand",
    "name": "{{ .Params.brand | default "Unknown" }}"
  },
  "sku": "{{ .Params.asin }}",
  {{ if and .Params.rating (ne (string .Params.rating) "0") }}
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "{{ .Params.rating }}",
    "bestRating": "5",
    "worstRating": "1",
    "ratingCount": "1"
  },
  {{ end }}
  "offers": {
    "@type": "Offer",
    "url": "{{ .Permalink }}",
    "priceCurrency": "JPY",
    "price": "{{ index (findRE "[0-9]+" (replace .Params.price "," "")) 0 | default 0 }}",
    "availability": "https://schema.org/InStock"
  }
}
</script>
{{ end }}

<!-- BreadcrumbList Schema (All Pages) with Parent Category Support -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
    "@type": "ListItem",
    "position": 1,
    "name": "ホーム",
    "item": "{{ .Site.BaseURL }}"
  }
  {{ if .IsPage }}
    {{ $category := "" }}
    {{ if .Params.categories }}
      {{ $category = index .Params.categories 0 }}
    {{ else if .Params.category }}
      {{ $category = .Params.category }}
    {{ end }}

    {{ $parentName := "" }}
    {{ $parentSlug := "" }}
    {{ $position := 2 }}

    {{ if $category }}
      {{/* 親カテゴリを検索 */}}
      {{ range $parent, $data := site.Data.categorygroups }}
        {{ range $data.categories }}
          {{ if eq . $category }}
            {{ $parentName = $parent }}
            {{ $parentSlug = $data.slug }}
          {{ end }}
        {{ end }}
      {{ end }}

      {{/* 親カテゴリがある場合 */}}
      {{ if $parentName }}
      ,{
        "@type": "ListItem",
        "position": {{ $position }},
        "name": "{{ $parentName }}",
        "item": "{{ .Site.BaseURL }}parent-category/{{ $parentSlug }}/"
      }
      {{ $position = 3 }}
      {{ end }}

      {{/* 子カテゴリ */}}
      ,{
        "@type": "ListItem",
        "position": {{ $position }},
        "name": "{{ $category }}",
        "item": "{{ .Site.BaseURL }}categories/{{ $category | urlize }}/"
      }
      {{ if $parentName }}{{ $position = 4 }}{{ else }}{{ $position = 3 }}{{ end }}
    {{ end }}

    {{/* 現在のページ */}}
    ,{
      "@type": "ListItem",
      "position": {{ if $parentName }}4{{ else if $category }}3{{ else }}2{{ end }},
      "name": "{{ .Title }}",
      "item": "{{ .Permalink }}"
    }
  {{ end }}
  ]
}
</script>