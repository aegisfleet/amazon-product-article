{{ $priceRaw := 0 }}
{{ if .Params.price }}
{{ $priceRaw = index (findRE "[0-9]+" (replace .Params.price "," "")) 0 | default 0 }}
{{ end }}
{{ $dateRaw := .Date.Unix }}
{{ with .Params.last_investigated }}{{ $dateRaw = (time .).Unix }}{{ end }}
<article class="card" data-price="{{ $priceRaw }}" data-score="{{ .Params.score | default 0 }}"
    data-date="{{ $dateRaw }}">
    <div class="card-image">
        <a href="{{ .RelPermalink }}" aria-label="{{ .Title }}ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’èª­ã‚€"
            style="display: block; width: 100%; height: 100%;">
            <!-- Placeholder for product image integration later -->
            {{ if .Params.images }}
            <img src="{{ index .Params.images 0 }}" alt="{{ .Title }}"
                style="width:100%; height:100%; object-fit:cover;">
            {{ else }}
            <div
                style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; background:#f3f4f6; color:#9ca3af;">
                ç”»åƒãªã—
            </div>
            {{ end }}
        </a>
    </div>
    <div class="card-content">
        <div class="card-header">
            {{ $categories := .GetTerms "categories" }}
            {{ if $categories }}
            {{ $firstCat := index $categories 0 }}
            <a href="{{ $firstCat.RelPermalink }}" class="card-tag">{{ $firstCat.LinkTitle }}</a>
            {{ with .Params.subcategory }}<span class="card-tag-sub">{{ . }}</span>{{ end }}
            {{ else if .Params.category }}
            <span class="card-tag">{{ .Params.category }}</span>
            {{ with .Params.subcategory }}<span class="card-tag-sub">{{ . }}</span>{{ end }}
            {{ end }}
            <h3 class="card-title">
                <a href="{{ .RelPermalink }}">{{ .Title }}</a>
            </h3>
        </div>
        <p class="card-excerpt">
            {{ .Description | default (.Summary | truncate 100) }}
        </p>
        <div class="card-meta-ext">
            {{ if .Params.price }}
            <span class="card-price">
                ğŸ’° {{ .Params.price }}
            </span>
            {{ end }}
            {{ if .Params.score }}
            <span class="card-score">
                ğŸ† {{ .Params.score }}ç‚¹
            </span>
            {{ end }}
        </div>
        <div class="card-footer">
            <span class="article-meta">{{ with .Params.last_investigated }}{{ time . | dateFormat "2006å¹´01æœˆ02æ—¥" }}{{
                else }}{{ .Date.Format "2006å¹´01æœˆ02æ—¥" }}{{ end }}</span>
            <a href="{{ .RelPermalink }}" class="read-more">ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’èª­ã‚€ â†’</a>
        </div>
    </div>
</article>