{{ define "main" }}
<section class="hero">
    <div class="container hero-content">
        <div class="hero-image">
            <img src="{{ `images/default-ogp.png` | relURL }}" alt="ã‚¹ãƒãƒ¼ãƒˆãªå•†å“ãƒªã‚µãƒ¼ãƒ" width="400" height="300">
        </div>
        <p class="hero-description">
            ã“ã®ã‚µã‚¤ãƒˆã§ã¯ã€<b>Googleã®Jules</b>ãŒèª¿ã¹ãŸèª¿æŸ»ãƒ¬ãƒãƒ¼ãƒˆã‚’é–²è¦§ã§ãã¾ã™ã€‚å„å•†å“ã®ç‰¹å¾´ã€ä½¿ç”¨æ–¹æ³•ã‚’æŠŠæ¡ã—ã€ç›®çš„ã«å¿œã˜ãŸæœ€é©ãªå•†å“ã®æ¯”è¼ƒæ¤œè¨ã«ãŠå½¹ç«‹ã¦ãã ã•ã„ã€‚ãªãŠã€<u>AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®èª¿æŸ»ãŒé–“é•ã£ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã“ã¨</u>ã«ç•™æ„ã—ã¦ãã ã•ã„ã€‚
        </p>
    </div>
</section>

<section class="container" style="margin-top: var(--spacing-lg);">
    <!-- Product Count Display -->
    {{ $articles := where .Site.RegularPages "Section" "articles" }}
    <div class="product-count-container">
        <div class="product-count-badge">
            <span class="product-count-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10 9 9 9 8 9"></polyline>
                </svg>
            </span>
            <span class="product-count-text">æ²è¼‰å•†å“æ•°: <span class="product-count-number">{{ len $articles }}</span>
                ç‚¹</span>
        </div>
    </div>

    <!-- High Score Pickup Section (90ç‚¹ä»¥ä¸Š) -->
    {{ $highScoreArticles := where (where .Site.RegularPages "Section" "articles") ".Params.score" "ge" 90 }}
    {{ if gt (len $highScoreArticles) 0 }}
    {{ $shuffled := shuffle $highScoreArticles }}
    {{ $pickupItems := first 5 $shuffled }}
    <div class="pickup-section">
        <div class="pickup-header">
            <h3 class="pickup-title">ğŸ† é«˜è©•ä¾¡ãŠã™ã™ã‚</h3>
            <span class="pickup-subtitle">90ç‚¹ä»¥ä¸Šã®å³é¸å•†å“</span>
            <button id="shuffle-pickup" class="shuffle-btn" aria-label="è¡¨ç¤ºå•†å“ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«">
                ğŸ”€ ã‚·ãƒ£ãƒƒãƒ•ãƒ«
            </button>
        </div>
        <div class="pickup-grid" id="pickup-grid">
            {{ range $pickupItems }}
            <a href="{{ .RelPermalink }}" class="pickup-card" data-score="{{ .Params.score }}" data-price="{{ .Params.price }}">
                <div class="pickup-card-image">
                    {{ if .Params.images }}
                    <img src="{{ index .Params.images 0 }}" alt="{{ .Title }}" loading="lazy">
                    {{ else }}
                    <div class="pickup-card-noimage">ç”»åƒãªã—</div>
                    {{ end }}
                </div>
                <div class="pickup-card-content">
                    <p class="pickup-card-title">{{ .Title | truncate 30 }}</p>
                    <div class="pickup-card-meta">
                        <span class="pickup-card-score">ğŸ† {{ .Params.score }}ç‚¹</span>
                        {{ if .Params.price }}
                        <span class="pickup-card-price">{{ .Params.price }}</span>
                        {{ end }}
                    </div>
                </div>
            </a>
            {{ end }}
        </div>
    </div>
    <!-- Pickup Data for Shuffle -->
    <script id="pickup-data" type="application/json">
    [{{ range $index, $item := $highScoreArticles }}{{ if $index }},{{ end }}{
        "url": "{{ $item.RelPermalink }}",
        "title": "{{ $item.Title | truncate 30 }}",
        "image": "{{ with $item.Params.images }}{{ index . 0 }}{{ end }}",
        "score": {{ $item.Params.score | default 0 }},
        "price": "{{ $item.Params.price }}"
    }{{ end }}]
    </script>
    {{ end }}

    <!-- Search Section -->
    <div class="search-container">
        <div class="search-input-wrapper">
            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <input type="text" id="search-input" class="search-input" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¢ã™ (ANDæ¤œç´¢å¯)" autocomplete="off"
                data-search-index-url="{{ `index.json` | relURL }}">
        </div>
        <div id="search-results"></div>
    </div>

    <div class="header-content" style="margin-bottom: var(--spacing-md);">
        <h2>ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰æ¢ã™</h2>
    </div>

    <!-- Mobile: Dropdown UI -->
    {{ $urlMap := dict }}{{ range $name, $items := .Site.Taxonomies.categories }}{{ with $.Site.GetPage (printf
    "/categories/%s" $name) }}{{ $urlMap = merge $urlMap (dict .LinkTitle .RelPermalink) }}{{ end }}{{ end }}
    <script id="category-url-data" type="application/json">{{ $urlMap | jsonify | safeJS }}</script>
    <div class="category-dropdown-container" id="category-dropdown-container">
        <div class="category-dropdown-group">
            <label for="category-group-select" class="category-dropdown-label">ã‚°ãƒ«ãƒ¼ãƒ—</label>
            <select id="category-group-select" class="category-dropdown-select">
                <option value="">ã‚°ãƒ«ãƒ¼ãƒ—ã‚’é¸æŠ...</option>
            </select>
        </div>
        <div class="category-dropdown-group">
            <label for="category-sub-select" class="category-dropdown-label">ã‚«ãƒ†ã‚´ãƒª</label>
            <select id="category-sub-select" class="category-dropdown-select" disabled>
                <option value="">ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠ...</option>
            </select>
        </div>
    </div>

    <!-- Desktop: Grouped View (Populated by JS) -->
    <div id="category-grouped-view" class="category-grouped-view"></div>

    <div class="header-content" style="margin-bottom: var(--spacing-lg);">
        <h2>æœ€æ–°ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
    </div>

    <div class="card-grid" id="product-grid">
        {{ $articles := where .Site.RegularPages "Section" "articles" }}
        {{ $sorted := sort $articles ".Params.last_investigated" "desc" }}
        {{ range $index, $element := $sorted }}
        <div class="card-wrapper{{ if ge $index 15 }} card-hidden{{ end }}">
            {{ partial "product-card.html" . }}
        </div>
        {{ end }}
    </div>

    {{ if gt (len $sorted) 15 }}
    <div class="load-more-container" id="load-more-container">
        <button id="load-more-button" class="btn-load-more">ã‚‚ã£ã¨è¦‹ã‚‹</button>
    </div>
    {{ end }}
</section>
{{ end }}